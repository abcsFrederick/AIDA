"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[260],{9260:function(e,t,r){r.d(t,{Z:function(){return Be}});var n=r(4051),a=r.n(n),o=r(5893),i=r(7294),s=r(2687),l=r(5783),c=r(9129),u=r(3504),f=r(8243),g=r(8569),d=r(2921),y=r(8984),m=r(6408),v=r(5055);function h(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void r(c)}s.done?t(l):Promise.resolve(l).then(n,a)}var b=function(){var e,t=(e=a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.parseStringPromise)(t);case 2:if((r=e.sent).hasOwnProperty("Image")){e.next=5;break}throw new Error("Invalid DZI: no <Image> specification.");case 5:if(r.Image.hasOwnProperty("$")){e.next=7;break}throw new Error("Invalid DZI: invalid <Image> specification (expected strange $ xml parsing).");case 7:if(r.Image.$.hasOwnProperty("Format")){e.next=9;break}throw new Error("Invalid DZI: no <Image><Format> specification.");case 9:if(r.Image.$.hasOwnProperty("Overlap")){e.next=11;break}throw new Error("Invalid DZI: no <Image><Overlap> specification.");case 11:if(r.Image.$.hasOwnProperty("TileSize")){e.next=13;break}throw new Error("Invalid DZI: no <Image><TileSize> specification.");case 13:if(r.Image.hasOwnProperty("Size")){e.next=15;break}throw new Error("Invalid DZI: no <Image><Size> specification.");case 15:if(r.Image.Size[0].hasOwnProperty("$")){e.next=17;break}throw new Error("Invalid DZI: invalid <Image><Size> specification (expected strange $ xml parsing).");case 17:if(r.Image.Size[0].$.hasOwnProperty("Width")){e.next=19;break}throw new Error("Invalid DZI: no <Image><Size><Width> specification.");case 19:if(r.Image.Size[0].$.hasOwnProperty("Height")){e.next=21;break}throw new Error("Invalid DZI: no <Image><Size><Height> specification.");case 21:return e.abrupt("return",{format:r.Image.$.Format,overlap:Number(r.Image.$.Overlap),tileSize:Number(r.Image.$.TileSize),size:{width:Number(r.Image.Size[0].$.Width),height:Number(r.Image.Size[0].$.Height)}});case 22:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){h(o,n,a,i,s,"next",e)}function s(e){h(o,n,a,i,s,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),p=r(2586),x=r(8256),w=r(2693),j=r(7718),k=r(7527),C=r(3151),S=r(3444);function N(e,t){var r=e.geometry.coordinates,n=new p.Z;switch(e.geometry.type){case"Point":n.setGeometry(new x.Z(r));break;case"LineString":n.setGeometry(new w.Z(r));break;case"Polygon":n.setGeometry(new j.ZP(r))}if(Object.hasOwnProperty.call(e,"class")){var a,o=t.find((function(t){return t.id===e.class}));a=o&&o.style.fill?new k.ZP({stroke:new C.Z({color:o.style.stroke.color||[128,100,211,1],width:o.style.stroke.width||1}),fill:new S.Z({color:o.style.fill.color})}):new k.ZP({stroke:new C.Z({color:o&&o.style.stroke.color||[128,100,211,1],width:o&&o.style.stroke.width||1})}),n.setStyle(a)}return Object.keys(e).forEach((function(t){"geometry"!==t&&n.set(t,e[t])})),n}var P=r(8315),A=r(2249),O=r(4240),Z=r(9303),I=r(1364),L=r(4098),F=r(5341),E=r(7016),D=r(6884),V=r(1664),z=r(3801),B=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r="",n=t?"abcdefghijklmnopqrstuvwxyz0123456789":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<e;a+=1)r+=n.charAt(Math.floor(Math.random()*n.length));return r};function M(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void r(c)}s.done?t(l):Promise.resolve(l).then(n,a)}function T(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){T(e,t,r[t])}))}return e}var R={header:{schemaVersion:"2.0",timestamp:Date.now()},layers:[],classes:[]},G=function(){var e,t=(e=a().mark((function e(t){var r,n,o,i,s,l,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=H({},R)).header.timestamp=Date.now(),n=t.get("featureClasses"),r.classes=Object.values(n),o=t.getLayers(),i=o.getArray().filter((function(e){return"annotation"===e.get("type")})),r.layers=i.map((function(e){var t=e.getSource().getFeatures().flatMap((function(e){var t=e.getGeometry();if(t){var r=t.getType(),n=t.getCoordinates();return{id:e.get("id")||B(),class:e.get("class"),geometry:{type:r,coordinates:n}}}return[]}));return{id:e.get("id"),features:t}})),s=window.location.pathname,l=s.replace(/\.[^.]+$/,".json"),!s.endsWith(".json")){e.next=18;break}return e.next=12,fetch("http://localhost:8000/data".concat(s));case 12:if(!(c=e.sent).ok){e.next=18;break}return e.next=16,c.json();case 16:u=e.sent,l=u.annotation;case 18:return e.prev=19,e.next=22,fetch("".concat("http://localhost:8000","/save"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({annotationPath:l,annotationData:r})});case 22:t.set("unsavedChanges",!1),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(19),console.error(e.t0);case 28:case"end":return e.stop()}}),e,null,[[19,25]])})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){M(o,n,a,i,s,"next",e)}function s(e){M(o,n,a,i,s,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),$=function(e){var t=e.map,r=["pan","select","modify","point","lineString","polygon","box"],n=t.getLayers().get("active").layer,a=(0,i.useState)("pan"),s=a[0],l=a[1],c=(0,i.useState)(n.getSource()),u=c[0],f=c[1];(0,i.useEffect)((function(){var e=t.getLayers(),r=function(){var t=e.get("active").layer;t&&f(t.getSource())};return e.on("propertychange",r),function(){e.un("propertychange",r)}}),[t]);var g=[],d=[0,0];t.on("pointermove",(function(e){d=e.coordinate}));var y=(0,i.useState)(!1),m=y[0],v=y[1];return(0,i.useEffect)((function(){var e=function(){return v(t.get("unsavedChanges"))};return t.on("propertychange",e),function(){return t.un("propertychange",e)}}),[t]),(0,i.useEffect)((function(){var e=function(e){var r=t.get("featureClasses")[t.get("activeFeatureClass")];e.feature.set("class",r.id),e.feature.setStyle(new k.ZP({stroke:new C.Z({color:r.style.stroke.color,width:r.style.stroke.width})})),r.style.fill&&e.feature.setStyle(new k.ZP({fill:new S.Z({color:r.style.fill.color}),stroke:new C.Z({color:r.style.stroke.color,width:r.style.stroke.width})}))};t.getInteractions().clear();var r=new A.Z({condition:function(e){return 1===e.originalEvent.button}});r.set("id","conditionalDragPan");var n=new O.Z;n.setActive(!0),n.set("id","mouseWheelZoom");var a=new A.Z;a.set("id","pan");var o=new Z.Z;o.set("id","rotate");var i=new I.Z;i.setActive(!1),i.set("id","select");var s=new L.Z({className:"border border-blue-500 bg-gray-50 bg-opacity-25"});s.on("boxend",(function(){var e=s.getGeometry().getExtent(),t=u.getFeaturesInExtent(e);i.getFeatures().clear(),i.getFeatures().extend(t)})),s.setActive(!1),s.set("id","dragBox");var l=new F.Z({features:i.getFeatures()});l.setActive(!1),l.set("id","translate");var c=new E.Z({features:i.getFeatures()});c.setActive(!1),c.set("id","modify");var f=new P.ZP({source:u,type:"Circle",geometryFunction:(0,P.dO)()});f.setActive(!1),f.set("id","box"),f.on("drawend",e);var g=new P.ZP({source:u,type:"Point"});g.setActive(!1),g.set("id","point");var d=new P.ZP({source:u,type:"LineString"});d.setActive(!1),d.set("id","lineString");var y=new P.ZP({source:u,type:"Polygon"});y.setActive(!1),y.set("id","polygon"),y.on("drawend",e),t.getInteractions().extend([r,n,a,o,i,s,l,c,f,g,d,y])}),[t,u]),(0,i.useEffect)((function(){var e=["mouseWheelZoom","conditionalDragPan"];switch(s){case"pan":e.push("pan","rotate");break;case"select":e.push("select","translate","dragBox");break;case"modify":e.push("modify","select","dragBox");break;case"point":e.push("point");break;case"lineString":e.push("lineString");break;case"polygon":e.push("polygon");break;case"box":e.push("box");break;default:e.push("pan")}t.getInteractions().getArray().forEach((function(t){e.includes(t.get("id"))?t.setActive(!0):t.setActive(!1)}))}),[s,t,u]),(0,i.useEffect)((function(){var e=function(e){if(e.code&&document.activeElement===document.body)switch(e.code){case"Space":e.preventDefault(),l("pan");break;case"Digit1":e.preventDefault(),l(r[0]);break;case"Digit2":e.preventDefault(),l(r[1]);break;case"Digit3":e.preventDefault(),l(r[2]);break;case"Digit4":e.preventDefault(),l(r[3]);break;case"Digit5":e.preventDefault(),l(r[4]);break;case"Digit6":e.preventDefault(),l(r[5]);break;case"Digit7":e.preventDefault(),l(r[6]);break;case"KeyA":if(e.preventDefault(),e.ctrlKey){l("select");var n=t.getLayers().getArray().find((function(e){return"annotation"===e.get("type")})).getSource().getFeatures(),a=t.getInteractions().getArray().find((function(e){return"select"===e.get("id")}));a.getFeatures().clear(),a.getFeatures().extend(n)}break;case"KeyC":if(e.preventDefault(),e.ctrlKey){var o=t.getInteractions().getArray().find((function(e){return"select"===e.get("id")}));g=o.getFeatures().getArray().map((function(e){o.restorePreviousStyle_(e);var t=e.clone();return o.applySelectedStyle_(e),t}))}break;case"KeyV":if(e.preventDefault(),e.ctrlKey){var i=g.reduce((function(e,t){var r=t.getGeometry();return r?D.l7(e,r.getExtent()):e}),D.lJ()),s=D.qg(i),c=d.map((function(e,t){return e-s[t]})),f=g.map((function(e){var t=e.clone(),r=t.getGeometry();return r&&r.translate(c[0],c[1]),t}));t.getLayers().getArray().find((function(e){return"annotation"===e.get("type")})).getSource().addFeatures(f)}break;case"Delete":case"Backspace":e.preventDefault();for(var y=t.getInteractions().getArray().find((function(e){return"select"===e.get("id")}));y.getFeatures().getLength()>0;){var m=y.getFeatures().pop();m&&u.removeFeature(m)}}if(e.code)switch(e.code){case"KeyS":e.ctrlKey&&(e.preventDefault(),G(t))}};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}})),(0,o.jsxs)("div",{className:"absolute left-0 top-0 z-20 flex flex-col m-1",children:[(0,o.jsx)(V.default,{href:"/local",children:(0,o.jsx)("a",{className:"p-2 mb-2 shadow bg-teal-600 text-white rounded-md flex justify-center text-base font-medium hover:bg-teal-500 focus:outline-none focus:ring-2 ring-inset focus:ring-teal-500",children:(0,o.jsx)(z.Oqj,{className:"h-4 w-4","aria-hidden":"true"})})}),(0,o.jsx)("button",{className:"".concat(m?"bg-white border-gray-300 text-gray-500 hover:ring-2 hover:ring-teal-500 hover:bg-gray-100 active:bg-gray-100 transition ease-in-out duration-150 focus:outline-none ring-inset":"border-transparent text-gray-300"," border shadow rounded-md p-2 mb-2 text-sm leading-5 font-medium "),onClick:function(){return G(t)},"aria-label":"Save annotation",disabled:!m,title:"Save",type:"button",children:(0,o.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"cursor-click w-4 h-4",children:(0,o.jsx)("path",{fill:"currentColor",d:"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"})})}),(0,o.jsxs)("div",{className:"rounded-md pointer-events-auto border border-gray-300 bg-white shadow",children:[(null===r||void 0===r?void 0:r.includes("pan"))&&(0,o.jsx)("button",{className:"".concat("pan"===s?"text-teal-700 bg-gray-100 ring-2 ring-teal-500":"text-gray-500"," block border-b rounded-t-md p-2 text-sm leading-5 font-medium hover:ring-2 hover:ring-teal-500 hover:bg-gray-100 active:bg-gray-100 transition ease-in-out duration-150 focus:outline-none focus:ring-2 focus:ring-teal-500 ring-inset"),onClick:function(){return l("pan")},"aria-label":"Activate pan tool",title:"Pan",type:"button",children:(0,o.jsx)("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"cursor-click w-4 h-4",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M9 3a1 1 0 012 0v5.5a.5.5 0 001 0V4a1 1 0 112 0v4.5a.5.5 0 001 0V6a1 1 0 112 0v5a7 7 0 11-14 0V9a1 1 0 012 0v2.5a.5.5 0 001 0V4a1 1 0 012 0v4.5a.5.5 0 001 0V3z",clipRule:"evenodd"})})}),(null===r||void 0===r?void 0:r.includes("select"))&&(0,o.jsx)("button",{className:"".concat("select"===s?"text-teal-700 bg-gray-100 ring-2 ring-teal-500":"text-gray-500"," block p-2 text-sm leading-5 font-medium hover:ring-2 hover:ring-teal-500 hover:bg-gray-100 active:bg-gray-100 transition ease-in-out duration-150  focus:outline-none focus:ring-2 focus:ring-teal-500 ring-inset"),onClick:function(){return l("select")},"aria-label":"Activate select tool",title:"Select",type:"button",children:(0,o.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"cursor-click w-4 h-4",children:(0,o.jsx)("path",{d:"M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"})})}),(null===r||void 0===r?void 0:r.includes("modify"))&&(0,o.jsx)("button",{className:"".concat("modify"===s?"text-teal-700 bg-gray-100 ring-2 ring-teal-500":"text-gray-500"," block border-b p-2 text-sm leading-5 font-medium hover:ring-2 hover:ring-teal-500 hover:bg-gray-100 active:bg-gray-100 transition ease-in-out duration-150 focus:outline-none focus:ring-2 focus:ring-teal-500 ring-inset"),onClick:function(){return l("modify")},"aria-label":"Activate modify tool",title:"Modify",type:"button",children:(0,o.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"cursor-click w-4 h-4",children:(0,o.jsx)("path",{d:"M12,20L7,22L12,11L17,22L12,20M8,2H16V5H22V7H16V10H8V7H2V5H8V2M10,4V8H14V4H10Z"})})}),(null===r||void 0===r?void 0:r.includes("point"))&&(0,o.jsx)("button",{className:"".concat("point"===s?"text-teal-700 bg-gray-100 ring-2 ring-teal-500":"text-gray-500"," block border-b p-2 text-sm leading-5 font-medium hover:ring-2 hover:ring-teal-500 hover:bg-gray-100 active:bg-gray-100 transition ease-in-out duration-150 focus:outline-none focus:ring-2 focus:ring-teal-500 ring-inset"),onClick:function(){return l("point")},"aria-label":"Activate point tool",title:"Point",type:"button",children:(0,o.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",className:"cursor-click w-4 h-4",children:(0,o.jsx)("path",{d:"M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"})})}),(null===r||void 0===r?void 0:r.includes("lineString"))&&(0,o.jsx)("button",{className:"".concat("lineString"===s?"text-teal-700 bg-gray-100 ring-2 ring-teal-500":"text-gray-500"," block border-b p-2 text-sm leading-5 font-medium hover:ring-2 hover:ring-teal-500 hover:bg-gray-100 active:bg-gray-100 transition ease-in-out duration-150 focus:outline-none focus:ring-2 focus:ring-teal-500 ring-inset"),onClick:function(){return l("lineString")},"aria-label":"Activate line-string tool",title:"LineString",type:"button",children:(0,o.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"cursor-click w-4 h-4",children:(0,o.jsx)("path",{d:"M3.5,18.5L9.5,12.5L13.5,16.5L22,6.92L20.59,5.5L13.5,13.5L9.5,9.5L2,17L3.5,18.5Z"})})}),(null===r||void 0===r?void 0:r.includes("polygon"))&&(0,o.jsx)("button",{className:"".concat("polygon"===s?"text-teal-700 bg-gray-100 ring-2 ring-teal-500":"text-gray-500"," block p-2 text-sm leading-5 font-medium hover:ring-2 hover:ring-teal-500 hover:bg-gray-100 active:bg-gray-100 transition ease-in-out duration-150 focus:outline-none focus:ring-2 focus:ring-teal-500 ring-inset"),onClick:function(){return l("polygon")},"aria-label":"Activate polygon tool",title:"Polygon",type:"button",children:(0,o.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"cursor-click w-4 h-4",children:(0,o.jsx)("path",{d:"M17,15.7V13H19V17L10,21L3,14L7,5H11V7H8.3L5.4,13.6L10.4,18.6L17,15.7M22,5V7H19V10H17V7H14V5H17V2H19V5H22Z"})})}),(null===r||void 0===r?void 0:r.includes("box"))&&(0,o.jsx)("button",{className:"".concat("box"===s?"text-teal-700 bg-gray-100 ring-2 ring-teal-500":"text-gray-500"," block p-2 rounded-b-md text-sm leading-5 font-medium hover:ring-2 hover:ring-teal-500 hover:bg-gray-100 active:bg-gray-100 transition ease-in-out duration-150 focus:outline-none focus:ring-2 focus:ring-teal-500 ring-inset"),onClick:function(){return l("box")},"aria-label":"Activate box tool",title:"Box",type:"button",children:(0,o.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"cursor-click w-4 h-4",children:(0,o.jsx)("path",{d:"M4,6V19H20V6H4M18,17H6V8H18V17Z"})})})]})]})},U=function(e){var t=e.map,r=(0,i.useRef)(null);return(0,i.useEffect)((function(){r.current&&t.setTarget(r.current)}),[t]),(0,o.jsx)("div",{className:"flex flex-grow",ref:r})},J=r(3153),K=r(7582);function _(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ")}var W=function(e){var t=e.map,r=(0,i.useRef)(null),n=(0,i.useState)(!0),a=n[0],s=n[1];return(0,i.useEffect)((function(){var e=t.getLayers().getArray().find((function(e){return"image"===e.get("id")})).getSource(),n=new K.Z({className:"overview ol-overviewmap",collapsible:!1,layers:[new f.Z({source:e})],target:r.current||void 0});t.addControl(n)}),[t]),(0,o.jsxs)("div",{children:[(0,o.jsxs)("button",{className:_("text-gray-700 hover:bg-gray-50 hover:text-gray-900 bg-white group w-full flex items-center pr-2 py-2 text-left text-sm font-medium focus:outline-none focus:ring-2 focus:ring-teal-500 relative z-10 ring-inset"),onClick:function(){return s(!a)},children:[(0,o.jsx)("svg",{className:_(a?"text-gray-400 rotate-90":"text-gray-300","mr-2 shrink-0 h-5 w-5 group-hover:text-gray-400 transition-colors ease-in-out duration-150"),viewBox:"0 0 20 20","aria-hidden":"true",children:(0,o.jsx)("path",{d:"M6 6L14 10L6 14V6Z",fill:"currentColor"})}),"Overview"]}),(0,o.jsx)("div",{ref:r,className:"".concat(a?"":"hidden bg-gray-50"," h-32")})]})},X=r(1228),q=r(3746),Y=r(6654),Q=function(e){var t=e.layer,r=e.index,n=e.active,a=e.map,s=(0,i.useState)(!1),l=s[0],c=s[1],u=(0,i.useRef)(null),f=(0,i.useState)(t.get("id")),g=f[0],d=f[1],y=(0,i.useState)(t.getVisible()),m=y[0],v=y[1],h=(0,i.useRef)(t.getOpacity()),b=(0,i.useState)([0,0]),p=b[0],x=b[1],w=(0,i.useRef)(null);(0,i.useEffect)((function(){var e=function(){v(0!==t.getOpacity())};return t.on("change:opacity",e),function(){t.un("change:opacity",e)}}),[t]);return(0,o.jsxs)("div",{className:"".concat(n?"text-teal-800 bg-gray-100":"text-gray-700 bg-white"," flex justify-between w-full text-sm overflow-hidden"),onContextMenu:function(e){e.preventDefault(),w.current&&w.current.click(),x([e.clientX,e.clientY])},children:[(0,o.jsx)("button",{type:"button",className:"m-1 inline-flex items-center text-gray-500 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-teal-500",onClick:function(){0===t.getOpacity()?t.setOpacity(h.current):(h.current=t.getOpacity(),t.setOpacity(0))},children:m?(0,o.jsx)(z.tEF,{className:"h-4 w-4","aria-hidden":"true"}):(0,o.jsx)(z.Xl7,{className:"h-4 w-4","aria-hidden":"true"})}),(0,o.jsx)("input",{type:"text",name:"layer-name",ref:u,className:"".concat(l?"w-full m-1":"w-0"," block focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-teal-500 focus:border-teal-500 border-gray-300"),placeholder:t.get("id"),onBlur:function(){c(!1)},value:g,onChange:function(e){var r=e.target.value;d(r),t.set("id",r)},onKeyUp:function(e){"Enter"===e.key&&u.current&&u.current.blur()}}),(0,o.jsx)("button",{type:"button",className:"".concat(l?"w-0":"w-full m-1"," truncate text-left w-full hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-teal-500"),onClick:function(){return e=t,void a.getLayers().set("active",{layer:e,index:r});var e},onDoubleClick:function(){c(!0),u.current&&u.current.focus()},children:t.get("id")}),(0,o.jsxs)(q.v,{children:[(0,o.jsx)(q.v.Button,{ref:w}),(0,o.jsx)(Y.u,{enter:"transition duration-100 ease-out",enterFrom:"scale-95 opacity-0",enterTo:"scale-100 opacity-100",leave:"transition duration-75 ease-out",leaveFrom:"scale-100 opacity-100",leaveTo:"scale-95 opacity-0",children:(0,o.jsx)(q.v.Items,{className:"absolute w-28 mt-2 origin-top-right -translate-x-full bg-white divide-y divide-gray-100 rounded-sm shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",style:{left:p[0],top:p[1]},children:(0,o.jsx)("div",{className:"px-1 py-1 ",children:(0,o.jsx)(q.v.Item,{children:function(e){var r=e.active;return(0,o.jsx)("button",{className:"".concat(r?"bg-teal-500 text-white":"text-gray-900"," group flex rounded-sm items-center w-full p-1 text-sm"),onClick:function(){a.removeLayer(t)},children:"Delete"})}})})})})]})]})},ee=r(5708),te=r(9641),re=r(4140),ne=r(9815),ae=r(1663),oe=r(6595),ie=r(8800),se=r(4663),le=r(1071);function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ce(e,t,r[t])}))}return e}var fe=function(e){var t=(0,ae.bU)().locale,r=(0,ie.j)(ue({},e,{locale:t})),n=(0,i.useRef)(null),a=(0,i.useRef)(null),s=(0,i.useRef)(null),l=B(),c=(0,le.I)(ue({},e,{onKeyDown:function(e){"Enter"===e.key&&r.commit()}}),r,n),u=c.labelProps,f=c.groupProps,g=c.inputProps,d=c.incrementButtonProps,y=c.decrementButtonProps,m=(0,se.U)(d,a).buttonProps,v=(0,se.U)(y,s).buttonProps;return(0,o.jsxs)("div",{children:[e.label&&(0,o.jsx)("label",ue({className:"block text-sm font-medium text-gray-700"},u,{htmlFor:l,children:e.label})),(0,o.jsxs)("div",ue({},f,{className:"".concat(e.label?"mt-1":""," relative rounded-md shadow-sm flex"),children:[(0,o.jsx)("input",ue({type:"number"},g,{ref:n,id:l,className:"pl-1 focus:outline-none focus:ring-teal-500 w-full focus:border-teal-500 min-width-0 text-sm border border-gray-300 rounded-l-md"})),(0,o.jsxs)("div",{className:"flex flex-col border border-gray-300 rounded-r-md",children:[(0,o.jsx)("button",ue({className:"-ml-px relative inline-flex items-center px-1 text-sm font-medium rounded-r-md rounded-b-none text-gray-700 bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"},m,{ref:a,children:(0,o.jsx)(J.g8U,{className:"h-3 w-3","aria-hidden":"true"})})),(0,o.jsx)("button",ue({className:"-ml-px relative inline-flex items-center px-1 text-sm font-medium rounded-r-md rounded-t-none text-gray-700 bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"},v,{ref:s,children:(0,o.jsx)(J.v4q,{className:"h-3 w-3","aria-hidden":"true"})}))]})]}))]})};function ge(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ge(e,t,r[t])}))}return e}var ye=function(e){var t=e.state,r=e.trackRef,n=e.index,a=(0,i.useRef)(null),s=(0,oe.p)({index:n,trackRef:r,inputRef:a},t),l=s.thumbProps,c=s.inputProps,u=(0,te.Fx)(),f=u.focusProps,g=u.isFocusVisible;return(0,o.jsx)("div",{className:"absolute top-2 -translate-x-1/2 -translate-y-1/2",style:{left:"".concat(100*t.getThumbPercent(n),"%")},children:(0,o.jsx)("div",de({},l,{className:"w-3 h-3 rounded-full",style:{backgroundColor:g?"#1E40AF":t.isThumbDragging(n)?"#374151":"#6B7280"},children:(0,o.jsx)(re.T,{children:(0,o.jsx)("input",de({ref:a},(0,ne.dG)(c,f)))})}))})},me=function(e){var t=(0,i.useRef)(null),r=(0,ae.Ux)(e.formatOptions),n=(0,ee.x)(de({},e,{numberFormatter:r})),a=(0,oe.o)(e,n,t),s=a.groupProps,l=a.trackProps;return(0,o.jsx)("div",de({},s,{className:"w-full p-2",style:{touchAction:"none"},children:(0,o.jsxs)("div",{className:"w-full pl-2 flex items-center",children:[(0,o.jsxs)("div",de({},l,{ref:t,className:"relative h-4 flex-1",children:[(0,o.jsx)("div",{className:"absolute bg-gray-500 top-2 w-full -translate-y-1/2 flex-1",style:{height:2}}),(0,o.jsx)(ye,{index:0,state:n,trackRef:t})]})),(0,o.jsx)("div",{className:"ml-3 text-sm w-16 text-gray-700 shrink",children:(0,o.jsx)(fe,de({},e))})]})}))},ve=function(e){var t=e.activeLayer,r=(0,i.useState)(t.getOpacity()),n=r[0],a=r[1];return(0,i.useEffect)((function(){var e=function(){a(t.getOpacity())};return t.on("change:opacity",e),function(){t.un("change:opacity",e)}}),[t]),(0,o.jsx)("div",{className:"flex items-center",children:(0,o.jsx)(me,{minValue:0,maxValue:1,step:.01,"aria-label":"Layer ".concat(t.get("id")," opacity"),value:[n],onChange:function(e){var r="number"===typeof e?e:e[0];t.setOpacity(r)},formatOptions:{style:"percent"}})})},he=function(e){var t=e.map,r=(0,i.useRef)(1),n=function(e){return void 0!==t.getLayers().getArray().find((function(t){return t.get("id")===e}))};return(0,o.jsx)("div",{className:"flex justify-end",children:(0,o.jsx)("button",{type:"button",className:"inline-flex items-center m-1 text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500",onClick:function(){for(;n("Layer ".concat(r.current));)r.current+=1;var e="Layer ".concat(r.current),a=new g.Z({wrapX:!1});a.on(["addfeature","changefeature","removefeature"],(function(){return t.set("unsavedChanges",!0)}));var o=new d.Z({source:a});o.set("id",e),o.set("type","annotation"),t.addLayer(o)},title:"Add new layer",children:(0,o.jsx)(J.d2U,{className:"h-4 w-4","aria-hidden":"true"})})})};function be(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ")}var pe=function(e){var t=e.map,r=(0,i.useState)([]),n=r[0],a=r[1],s=(0,i.useState)(t.getLayers().get("active").layer),l=s[0],c=s[1];return(0,i.useEffect)((function(){var e=t.getLayers(),r=e.getArray().filter((function(e){return"annotation"===e.get("type")}));a(r),c(e.get("active").layer);var n=function(){c(e.get("active").layer)};e.on("propertychange",n);var o=function(){var t=e.getArray().filter((function(e){return"annotation"===e.get("type")}));if(a(t),!e.getArray().includes(l)){var r=e.get("active").index,n=e.item(r);e.set("active",{layer:n,index:r})}};return e.on("change:length",o),function(){e.un("change:length",o),e.un("propertychange",n)}}),[t,l]),(0,o.jsx)(X.p,{className:"shadow-sm",as:"div",children:function(e){var r=e.open;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(X.p.Button,{className:be("text-gray-700 hover:bg-gray-50 hover:text-gray-900 bg-white group w-full flex items-center pr-2 py-2 text-left text-sm font-medium focus:outline-none focus:ring-2 focus:ring-teal-500 relative z-10 ring-inset"),children:[(0,o.jsx)("svg",{className:be(r?"text-gray-400 rotate-90":"text-gray-300","mr-2 shrink-0 h-5 w-5 group-hover:text-gray-400 transition-colors ease-in-out duration-150"),viewBox:"0 0 20 20","aria-hidden":"true",children:(0,o.jsx)("path",{d:"M6 6L14 10L6 14V6Z",fill:"currentColor"})}),"Layers"]}),(0,o.jsxs)(X.p.Panel,{className:"bg-white rounded-b-sm",children:[l&&(0,o.jsx)(ve,{activeLayer:l}),(0,o.jsx)("div",{className:"max-h-40 overflow-y-auto",children:n.map((function(e,r){return(0,o.jsx)(Q,{layer:e,index:r,active:l===e,map:t},r)}))}),(0,o.jsx)(he,{map:t})]})]})}})},xe=r(7293);function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function je(e){return function(e){if(Array.isArray(e))return we(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return we(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return we(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ke=function(e){var t,r=e.activeFeatureClass,n=e.map,a=n.getInteractions().getArray().find((function(e){return"select"===e.get("id")})),s=(0,i.useState)((null===(t=r.style.fill)||void 0===t?void 0:t.color[3])||1),l=s[0],c=s[1];return(0,i.useEffect)((function(){var e=function(){var e;return c((null===(e=r.style.fill)||void 0===e?void 0:e.color[3])||1)};return n.on("propertychange",e),function(){n.un("propertychange",e)}}),[r,n]),(0,o.jsx)("div",{className:"flex items-center",children:(0,o.jsx)(me,{minValue:0,maxValue:1,step:.01,"aria-label":"Layer ".concat(r.id," opacity"),value:[l],onChange:function(e){var t,o;a&&(t=a,null!=(o=I.Z)&&"undefined"!==typeof Symbol&&o[Symbol.hasInstance]?o[Symbol.hasInstance](t):t instanceof o)&&a.getFeatures().clear();var i="number"===typeof e?e:e[0];if(n.getLayers().getArray().find((function(e){return"annotation"===e.get("type")})).getSource().getFeatures().filter((function(e){return e.get("class")===r.id})).forEach((function(e){var t=e.getStyle(),r=(0,xe._2)(t.getFill().getColor()),n=t.getStroke().clone(),a=(0,xe._2)(t.getStroke().getColor());n.setColor(je(a.slice(0,3)).concat([i])),e.setStyle(new k.ZP({fill:new S.Z({color:je(r.slice(0,3)).concat([i])}),stroke:n}))})),c(i),r.style.fill){r.style.fill.color[3]=i;var s=n.get("featureClasses");s[r.id].style.fill.color=r.style.fill.color,n.set("featureClasses",s)}n.set("change",Math.random())},formatOptions:{style:"percent"}})})},Ce=r(6835),Se=r(713),Ne=[{name:"Gray",hex:"#6b7280",borderColor:"border-gray-500",bgColor:"bg-gray-500",fill:[107,114,128,.3],stroke:[107,114,128,1]},{name:"Red",hex:"#ef4444",borderColor:"border-red-500",bgColor:"bg-red-500",fill:[239,68,68,.3],stroke:[239,68,68,1]},{name:"Orange",hex:"#f97316",borderColor:"border-orange-500",bgColor:"bg-orange-500",fill:[249,115,22,.3],stroke:[249,115,22,1]},{name:"Yellow",hex:"#eab308",borderColor:"border-yellow-500",bgColor:"bg-yellow-500",fill:[234,179,8,.3],stroke:[234,179,8,1]},{name:"Lime",hex:"#84cc16",borderColor:"border-lime-500",bgColor:"bg-lime-500",fill:[132,204,22,.3],stroke:[132,204,22,1]},{name:"Green",hex:"#22c55e",borderColor:"border-green-500",bgColor:"bg-green-500",fill:[34,197,94,.3],stroke:[34,197,94,1]},{name:"Teal",hex:"#14b8a6",borderColor:"border-teal-500",bgColor:"bg-teal-500",fill:[20,184,166,.3],stroke:[20,184,166,1]},{name:"Blue",hex:"#3b82f6",borderColor:"border-blue-500",bgColor:"bg-blue-500",fill:[59,130,246,.3],stroke:[59,130,246,1]},{name:"Purple",hex:"#a855f7",borderColor:"border-purple-500",bgColor:"bg-purple-500",fill:[168,85,247,.3],stroke:[168,85,247,1]},{name:"Pink",hex:"#ec4899",borderColor:"border-pink-500",bgColor:"bg-pink-500",fill:[236,72,153,.3],stroke:[236,72,153,1]}];function Pe(e){var t=e.color,r=e.onChange,n=(0,i.useState)({backgroundColor:"rgba(".concat(t.fill.join(","),")"),borderColor:"rgba(".concat(t.stroke.join(","),")")}),a=n[0],s=n[1],l=(0,i.useState)({borderColor:"rgba(".concat(t.stroke.join(","),")")}),c=l[0],u=l[1],f=(0,i.useState)({backgroundColor:"rgba(".concat(t.fill.join(","),")")}),g=f[0],d=f[1];(0,i.useEffect)((function(){s({backgroundColor:"rgba(".concat(t.fill.join(","),")"),borderColor:"rgba(".concat(t.stroke.join(","),")")}),u({borderColor:"rgba(".concat(t.stroke.join(","),")")}),d({backgroundColor:"rgba(".concat(t.fill.join(","),")")})}),[t]);return(0,o.jsx)(Ce.J,{className:"m-1",children:function(e){e.open;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ce.J.Button,{style:a,className:"w-4 h-4 rounded-sm border-4 focus:outline-none focus-visible:ring-2 focus-visible:ring-green focus-visible:ring-opacity-75"}),(0,o.jsx)(Y.u,{as:i.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:(0,o.jsx)(Ce.J.Panel,{className:"absolute z-10 w-48 p-2 transform -translate-x-56 -translate-y-1/2",children:(0,o.jsxs)("div",{className:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5",children:[(0,o.jsxs)("div",{className:"bg-white p-2",children:[(0,o.jsxs)("div",{className:"text-sm font-medium text-gray-800",children:[" ","Templates"," "]}),(0,o.jsx)("div",{className:"grid grid-cols-5 mt-2",children:Ne.map((function(e){return(0,o.jsx)("div",{className:"".concat(t.fill===e.fill?"bg-gray-200":""," rounded-sm flex justify-center align-middle"),children:(0,o.jsx)("button",{className:"m-1 border-4 ".concat(e.borderColor," ").concat(e.bgColor," bg-opacity-30 w-5 h-5 rounded-sm"),onClick:function(){return function(e){r(e.fill,e.stroke)}(e)}})},e.hex)}))})]}),(0,o.jsxs)("div",{className:" p-2 bg-white border-t-gray-50",children:[(0,o.jsxs)("div",{className:"relative text-sm font-medium text-gray-800",children:[" ","Custom"," "]}),(0,o.jsxs)(Ce.J,{children:[(0,o.jsxs)(Ce.J.Button,{className:"w-full text-sm text-gray-500 flex my-1 text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-green focus-visible:ring-opacity-75",children:[(0,o.jsx)("span",{className:"w-1/3",children:" Stroke "}),(0,o.jsx)("div",{style:c,className:"border-4 w-5 h-5 rounded-sm"})]}),(0,o.jsx)(Y.u,{enter:"transition duration-100 ease-out",enterFrom:"transform scale-95 opacity-0",enterTo:"transform scale-100 opacity-100",leave:"transition duration-75 ease-out",leaveFrom:"transform scale-100 opacity-100",leaveTo:"transform scale-95 opacity-0",children:(0,o.jsx)(Ce.J.Panel,{className:"absolute z-10 transform -translate-x-full -mx-4 -translate-y-1/2",children:(0,o.jsx)(Se.AI,{color:{r:t.stroke[0],g:t.stroke[1],b:t.stroke[2],a:t.stroke[3]},onChange:function(e){r(t.fill,[e.rgb.r,e.rgb.g,e.rgb.b,e.rgb.a||1])}})})})]}),(0,o.jsxs)(Ce.J,{children:[(0,o.jsxs)(Ce.J.Button,{className:"w-full text-sm text-gray-500 flex my-1 text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-green focus-visible:ring-opacity-75",children:[(0,o.jsx)("span",{className:"w-1/3",children:" Fill "}),(0,o.jsx)("div",{style:g,className:"w-5 h-5 rounded-sm"})]}),(0,o.jsx)(Y.u,{enter:"transition duration-100 ease-out",enterFrom:"transform scale-95 opacity-0",enterTo:"transform scale-100 opacity-100",leave:"transition duration-75 ease-out",leaveFrom:"transform scale-100 opacity-100",leaveTo:"transform scale-95 opacity-0",children:(0,o.jsx)(Ce.J.Panel,{className:"absolute z-10 transform -translate-x-full -mx-4 -translate-y-1/2",children:(0,o.jsx)(Se.AI,{color:{r:t.fill[0],g:t.fill[1],b:t.fill[2],a:t.fill[3]},onChange:function(e){r([e.rgb.r,e.rgb.g,e.rgb.b,e.rgb.a||1],t.stroke)}})})})]})]})]})})})]})}})}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Oe(e,t){return null!=t&&"undefined"!==typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function Ze(e){return function(e){if(Array.isArray(e))return Ae(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return Ae(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ae(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ie=function(e){var t,r,n,a=e.featureClass,s=e.active,l=e.map,c=e.setActiveFeatureClass,u=(0,i.useState)(a.style.stroke.color),f=u[0],g=u[1],d=(0,i.useState)((null===(t=a.style.fill)||void 0===t?void 0:t.color)||a.style.stroke.color),y=d[0],m=d[1],v=(0,i.useState)(!1),h=v[0],b=v[1],p=(0,i.useRef)(null),x=(0,i.useState)(a.name),w=x[0],j=x[1],N=l.getInteractions().getArray().find((function(e){return"select"===e.get("id")})),P=function(e){N&&Oe(N,I.Z)&&N.getFeatures().clear();var t="number"===typeof e?e:e[0];if(l.getLayers().getArray().find((function(e){return"annotation"===e.get("type")})).getSource().getFeatures().filter((function(e){return e.get("class")===a.id})).forEach((function(e){var r=e.getStyle(),n=(0,xe._2)(r.getFill().getColor()),a=r.getStroke().clone(),o=(0,xe._2)(r.getStroke().getColor());a.setColor(Ze(o.slice(0,3)).concat([t])),e.setStyle(new k.ZP({fill:new S.Z({color:Ze(n.slice(0,3)).concat([t])}),stroke:a}))})),a.style.fill){a.style.fill.color[3]=t;var r=l.get("featureClasses");r[a.id].style.fill.color=a.style.fill.color,l.set("featureClasses",r)}l.set("change",Math.random())},A=(0,i.useState)((null===(r=a.style.fill)||void 0===r?void 0:r.color[3])&&a.style.fill.color[3]>0),O=A[0],Z=A[1],L=(0,i.useRef)((null===(n=a.style.fill)||void 0===n?void 0:n.color[3])||a.style.stroke.color[3]);(0,i.useEffect)((function(){var e=function(){return Z(0!==a.style.stroke.color[3])};return l.on("propertychange",e),function(){l.un("propertychange",e)}}),[a,l]);return(0,o.jsxs)("div",{className:"".concat(s?"text-teal-800 bg-gray-100":"text-gray-700 bg-white"," flex justify-between w-full text-sm"),children:[(0,o.jsx)("button",{type:"button",className:"m-1 inline-flex items-center text-gray-500 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-teal-500",onClick:function(){var e;0===(null===(e=a.style.fill)||void 0===e?void 0:e.color[3])?(P([L.current||1]),Z(!0)):(L.current=l.get("featureClasses")[a.id].style.fill.color[3],P([0]),Z(!1))},children:O?(0,o.jsx)(z.tEF,{className:"h-4 w-4","aria-hidden":"true"}):(0,o.jsx)(z.Xl7,{className:"h-4 w-4","aria-hidden":"true"})}),(0,o.jsx)(Pe,{color:{fill:y,stroke:f},onChange:function(e,t){N&&Oe(N,I.Z)&&N.getFeatures().clear(),l.getLayers().getArray().find((function(e){return"annotation"===e.get("type")})).getSource().getFeatures().filter((function(e){return e.get("class")===a.id})).forEach((function(r){r.setStyle(new k.ZP({fill:new S.Z({color:e}),stroke:new C.Z({color:t})}))})),a.style.fill&&(a.style.fill.color=e),a.style.stroke.color=t;var r=l.get("featureClasses");r[a.id].style=a.style,l.set("featureClasses",r),l.set("unsavedChanges",!0),m(e),g(t)}}),(0,o.jsx)("input",{type:"text",name:"layer-name",ref:p,className:"".concat(h?"w-full m-1":"w-0"," block focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-teal-500 focus:border-teal-500 border-gray-300"),placeholder:a.name,onBlur:function(){b(!1)},value:w,onChange:function(e){var t=e.target.value;j(t);var r=l.get("featureClasses");r[a.id].name=t,l.set("featureClasses",r)},onKeyUp:function(e){"Enter"===e.key&&p.current&&p.current.blur()}}),(0,o.jsx)("button",{type:"button",className:"".concat(h?"w-0":"w-full m-1"," truncate text-left w-full hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-teal-500"),onClick:function(){return c(a),void l.set("activeFeatureClass",a.id)},onDoubleClick:function(){b(!0),p.current&&p.current.focus()},children:a.name})]})};function Le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Fe=function(e){var t=e.map,r=e.setFeatureClasses,n=function(e){var r=t.get("featureClasses");return void 0!==Object.values(r).find((function(t){return t.name===e}))};return(0,o.jsx)("div",{className:"flex justify-end",children:(0,o.jsx)("button",{type:"button",className:"inline-flex items-center m-1 text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500",onClick:function(){for(var e=t.get("featureClasses"),a=Object.keys(e).length+1;n("Class ".concat(a));)a+=1;var o="Class ".concat(a);e[a]={id:a,name:o,description:"Feature ".concat(a," class."),style:{stroke:{color:[51,153,204],width:1.25},fill:{color:[255,255,255,.4]}}},t.set("featureClasses",e),t.set("unsavedChanges",!0),r(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Le(e,t,r[t])}))}return e}({},e))},title:"Add new feature class",children:(0,o.jsx)(J.d2U,{className:"h-4 w-4","aria-hidden":"true"})})})};function Ee(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ")}var De=function(e){var t=e.map,r=(0,i.useState)(t.get("featureClasses")||{}),n=r[0],a=r[1],s=(0,i.useState)(t.get("featureClasses")[0]),l=s[0],c=s[1];return(0,o.jsx)(X.p,{className:"shadow-sm",as:"div",children:function(e){var r=e.open;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(X.p.Button,{className:Ee("text-gray-700 hover:bg-gray-50 hover:text-gray-900 bg-white group w-full flex items-center pr-2 py-2 text-left text-sm font-medium focus:outline-none focus:ring-2 focus:ring-teal-500 relative z-10 ring-inset"),children:[(0,o.jsx)("svg",{className:Ee(r?"text-gray-400 rotate-90":"text-gray-300","mr-2 shrink-0 h-5 w-5 group-hover:text-gray-400 transition-colors ease-in-out duration-150"),viewBox:"0 0 20 20","aria-hidden":"true",children:(0,o.jsx)("path",{d:"M6 6L14 10L6 14V6Z",fill:"currentColor"})}),"Classes"]}),(0,o.jsxs)(X.p.Panel,{className:"relative",children:[l&&(0,o.jsx)(ke,{activeFeatureClass:l,map:t}),(0,o.jsx)("div",{className:"max-h-40 overflow-y-auto",children:Object.values(n).map((function(e,r){return(0,o.jsx)(Ie,{featureClass:e,active:l===e,setActiveFeatureClass:c,map:t},e.id)}))}),(0,o.jsx)(Fe,{map:t,setFeatureClasses:a})]})]})}})},Ve=function(e){var t=e.map,r=(0,i.useState)(!0),n=r[0],a=r[1];return(0,i.useEffect)((function(){t.updateSize()}),[n,t]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("button",{onClick:function(){return a((function(e){return!e}))},className:"".concat(n?"w-48 flex justify-between border-l border-b-2 ring-inset":"rounded-bl-md"," hover:bg-gray-100 border-gray-200 shadow p-2 bg-white absolute top-0 right-0 inline-flex items-center text-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-500"),children:[!n&&(0,o.jsx)(J.wyc,{className:"h-5 w-5","aria-hidden":"true"}),"Settings",n&&(0,o.jsx)(J.XCv,{className:"h-5 w-5","aria-hidden":"true"})]}),n&&(0,o.jsxs)("div",{className:"bg-white border-l border-gray-200 mt-10 min-h-full w-48 shadow text-gray-800 flex flex-col divide-y",children:[(0,o.jsx)("div",{}),(0,o.jsx)(W,{map:t}),(0,o.jsx)(pe,{map:t}),(0,o.jsx)(De,{map:t}),(0,o.jsx)("div",{})]})]})};function ze(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void r(c)}s.done?t(l):Promise.resolve(l).then(n,a)}var Be=function(e){var t=e.imageUrl,r=e.annotationData,n=e.imageExt,v=(0,i.useState)(),h=v[0],p=v[1];return(0,i.useEffect)((function(){var e;(e=a().mark((function e(){var o,i,v,h,x,w,j,k,C,S,P,A,O,Z,I,L,F,E,D,V,z,B,M,T,H,R,G;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=new s.Z({controls:[]}),"dzi"!==n){e.next=27;break}return e.next=4,fetch(t);case 4:return i=e.sent,e.t0=b,e.next=8,i.text();case 8:return e.t1=e.sent,e.next=11,(0,e.t0)(e.t1);case 11:v=e.sent,h=new u.Z({code:"ZOOMIFY",units:"pixels",extent:[0,-v.size.height,v.size.width,0]}),x=t.substring(0,t.lastIndexOf(".")),w="".concat(x,"_files/{z}/{x}_{y}.").concat(v.format),j=new c.Z({projection:h,url:w,size:[v.size.width,v.size.height],tileSize:v.tileSize}),k=Math.ceil(Math.log(v.tileSize)/Math.LN2),j.setTileUrlFunction((function(e){return w.replace("{z}",(e[0]+k).toString()).replace("{x}",e[1].toString()).replace("{y}",e[2].toString())})),(C=new f.Z({source:j})).set("id","image"),C.set("type","image"),o.addLayer(C),S=new l.ZP({center:[v.size.width/2,v.size.height/2],resolutions:j.getTileGrid().getResolutions(),extent:j.getTileGrid().getExtent(),showFullExtent:!0}),o.setView(S),S.fit(j.getTileGrid().getExtent()),e.next=44;break;case 27:return e.next=29,fetch("".concat(t,"/info.json"));case 29:return P=e.sent,e.next=32,P.json();case 32:if(A=e.sent,void 0!==(O=new m.Z(A).getTileSourceOptions())&&void 0!==O.version){e.next=36;break}throw new Error("Unable to parse IIIF info.json");case 36:Z=new y.Z(O),(I=new f.Z({source:Z})).set("id","image"),I.set("type","image"),o.addLayer(I),L=new l.ZP({center:[A.width/2,A.height/2],resolutions:Z.getTileGrid().getResolutions(),extent:Z.getTileGrid().getExtent(),showFullExtent:!0}),o.setView(L),L.fit(Z.getTileGrid().getExtent());case 44:for(F=function(){o.set("unsavedChanges",!0)},E=!0,D=!1,V=void 0,e.prev=46,z=r.layers[Symbol.iterator]();!(E=(B=z.next()).done);E=!0)M=B.value,T=new g.Z({wrapX:!1}),(H=new d.Z({source:T})).set("id",M.id),H.set("type","annotation"),o.addLayer(H),R=M.features.map((function(e){return N(e,r.classes)})),T.addFeatures(R),T.on(["addfeature","changefeature","removefeature"],F);e.next=54;break;case 50:e.prev=50,e.t2=e.catch(46),D=!0,V=e.t2;case 54:e.prev=54,e.prev=55,E||null==z.return||z.return();case 57:if(e.prev=57,!D){e.next=60;break}throw V;case 60:return e.finish(57);case 61:return e.finish(54);case 62:return o.set("featureClasses",r.classes),o.set("activeFeatureClass",0),G=o.getLayers().getArray().filter((function(e){return"annotation"===e.get("type")}))[0],o.getLayers().set("active",{layer:G,index:0}),p(o),e.abrupt("return",(function(){o.getLayers().forEach((function(e){var t,r;t=e,(null!=(r=d.Z)&&"undefined"!==typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](t):t instanceof r)&&e.getSource().un(["addfeature","changefeature","removefeature"],F)}))}));case 68:case"end":return e.stop()}}),e,null,[[46,50,54,62],[55,,57,61]])})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){ze(o,n,a,i,s,"next",e)}function s(e){ze(o,n,a,i,s,"throw",e)}i(void 0)}))})()}),[t,r.classes,r.layers,n]),(0,o.jsxs)("div",{className:"min-w-full min-h-screen flex bg-gray-100",children:[h&&(0,o.jsx)($,{map:h}),h&&(0,o.jsx)(U,{map:h}),h&&(0,o.jsx)(Ve,{map:h})]})}}}]);